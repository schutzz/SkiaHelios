# rules/triage_rules.yaml [Themis Law v2.4]
# Update: Added Critical Anti-Forensics Signatures (Timestomp/Wiping)

# --- [Persistence Targets (AION Scope)] ---
persistence_targets:
  - name: "Run Keys"
    category: "Registry"
    pattern: "Microsoft\\\\Windows\\\\CurrentVersion\\\\Run"
  
  - name: "RunOnce Keys"
    category: "Registry"
    pattern: "Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce"

  - name: "Services"
    category: "Registry"
    pattern: "Services"

  - name: "Scheduled Tasks"
    category: "Registry"
    pattern: "ScheduledTasks"

# ==========================================
# ü¶Å Living off the Land (LotL) Detection
# ==========================================
living_off_the_land:
  description: "Native OS tools commonly abused by attackers for reconnaissance/discovery"
  score_single: 30
  score_cluster_threshold: 2   # 2„Å§‰ª•‰∏ä„Åß„ÇØ„É©„Çπ„ÇøÂà§ÂÆö
  score_cluster_bonus: 120     # „ÇØ„É©„Çπ„ÇøÊôÇ„ÅÆ„Éú„Éº„Éä„Çπ„Çπ„Ç≥„Ç¢
  tools:
    - whoami.exe
    - ipconfig.exe
    - net.exe
    - net1.exe
    - netstat.exe
    - systeminfo.exe
    - tasklist.exe
    - query.exe
    - nltest.exe
    - dsquery.exe
    - cmdkey.exe
    - nslookup.exe
    - arp.exe
    - route.exe
    - hostname.exe

# ==========================================
# üõ†Ô∏è Dual-Use / Admin Tools Configuration
# ==========================================
dual_use_tools:
  # [1] „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Çπ„Ç≠„É£„É≥ & ÂÅµÂØü
  - name: "Network Scanner"
    keywords: 
      - "nmap"
      - "zenmap"
      - "masscan"
      - "angryip"
      - "advanced_ip_scanner"
      - "netscan"
    noise_paths: ["nmap/scripts", "nmap/nselib", "nmap/docs"]

  # [2] „Éë„Ç±„ÉÉ„Éà„Ç≠„É£„Éó„ÉÅ„É£ & Ëß£Êûê
  - name: "Packet Capture"
    keywords: 
      - "wireshark"
      - "tshark"
      - "capinfos"
      - "tcpdump"
      - "windump"
      - "winpcap"
      - "npcap"
    noise_paths: ["wireshark/snmp", "wireshark/radius", "wireshark/help", "wireshark/dtds", "wireshark/profiles"]

  # [3] „É™„É¢„Éº„Éà„Ç¢„ÇØ„Çª„Çπ & Ê®™Â±ïÈñã
  - name: "Remote Admin / Lateral"
    keywords: 
      - "psexec"
      - "paexec"
      - "winscp"
      - "putty"
      - "plink"
      - "teamviewer"
      - "anydesk"
      - "logmein"
      - "screenconnect"
      - "radmin"
      - "vnc"
      - "vnc"
      - "mstsc"
      - "sync"       # Sysinternals Sync (Flush file buffers)
      - "handle"     # Sysinternals Handle
      - "sdelete"    # Sysinternals SDelete
    noise_paths: ["teamviewer/version", "anydesk/ad_printer"]

  # [NEW] Anti-Forensics & Timestomp Tools
  - name: "Time Manipulation"
    keywords:
      - "dcode"
      - "timestomp"
      - "setmace"
      - "nircmd"
      - "attributechanger"
    noise_paths: []

  # [4] „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÉÑ„Éº„É´ & „Éà„É≥„Éç„É™„É≥„Ç∞
  - name: "Net Tool / Tunneling"
    keywords: 
      - "netcat"
      - "nc.exe"
      - "ncat"
      - "socat"
      - "ngrok"
      - "frp"
      - "chisel"
      - "termite"
      - "proxifier"
    noise_paths: []

  # [5] Active Directory ÂÅµÂØü & Ë™çË®ºÊÉÖÂ†±Á™ÉÂèñ
  - name: "Recon / Credential"
    keywords: 
      - "adfind"
      - "bloodhound"
      - "sharphound"
      - "powerview"
      - "mimikatz"
      - "lazagne"
      - "procdump"
      - "hashcat"
      - "john"
    noise_paths: []

  # [6] „Éá„Éº„ÇøÊåÅ„Å°Âá∫„Åó (Exfiltration) & ÂúßÁ∏Æ
  - name: "Exfiltration / Archiver"
    keywords: 
      - "rclone"
      - "megasync"
      - "7za.exe"
      - "rar.exe"
      - "winrar"
    noise_paths: []

  # [7] ÂåøÂêçÂåñ & Web„Ç¢„ÇØ„Çª„Çπ
  - name: "Anonymity / Tor"
    keywords: 
      - "tor.exe"
      - "tor browser"
      - "onion"
    noise_paths: ["tor/pluggabletransports", "browser/torbrowser/data"]

  # [8] ÈñãÁô∫Ë®ÄË™û & „Çπ„ÇØ„É™„Éó„Éà„Ç®„É≥„Ç∏„É≥
  - name: "Dev / Scripting"
    keywords: 
      - "python"
      - "pip"
      - "perl"
      - "ruby"
      - "lua"
      - "autoit"
      - "powershell_ise"
    noise_paths: 
      - "python/lib"
      - "python/tcl"
      - "python/include"
      - "lib/test"
      - "lib/site-packages"
      - "perl/lib"
      - "ruby/lib"
    
      - "ruby/lib"
    


# ==========================================
# üìÇ LNK / Shortcut Analysis Rules (Update)
# ==========================================
lnk_threats:
  - name: "WordPad Usage (Manual Access)"
    tag: "MANUAL_DOC_ACCESS"
    score: 100
    pat: "(?i)wordpad.exe"

  - name: "RecentDocs Access"
    tag: "RECENT_DOCS"
    score: 50
    pat: "(?i)Recent"

# ==========================================
# üõ°Ô∏è NOISE FILTERS (Ignored Artifacts)
# ==========================================
noise_filters:
  # --- [User Artifacts Noise] ---
  - name: "Windows Sample Media (Folder)"
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(Sample Music|Sample Pictures|Sample Videos)$"

  - name: "Windows Sample Media (Contents)"
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)\\\\(Sample Music|Sample Pictures|Sample Videos)"

  - name: "Browser History & Cache (Folder)"
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(History|Temporary Internet Files|Content\\.IE5|INetCache|Cookies)$"

  - name: "Browser History & Cache (Contents)"
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)\\\\(History|Temporary Internet Files|Content\\.IE5|INetCache|Cookies)"

  - name: "Standard Temp Folders (Folder)"
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(Temp|Tmp|Application Data)$"

  - name: "Standard Temp Folders (Contents)"
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)\\\\(AppData\\\\Local\\\\Temp|Windows\\\\Temp)"

  - name: "Common Noisy System Folders"
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(Microsoft|Windows|Internet Explorer|Quick Launch)$"

  # --- [Additional System Noise] ---
  - name: 'Cryptnet Cache'
    target: 'ParentPath'
    condition: 'regex'
    pattern: '(?i)Microsoft.CryptnetUrlCache'

  - name: 'Google App Caches'
    target: 'ParentPath'
    condition: 'regex'
    pattern: '(?i)Google.(Drive|Chrome).*(Cache|HttpCache|TempData)'

  - name: 'Skype Cache'
    target: 'ParentPath'
    condition: 'regex'
    pattern: '(?i)Skype.*(media_messaging|thmanager|emo_cache)'

  - name: 'CLR Usage Logs'
    target: 'ParentPath'
    condition: 'regex'
    pattern: '(?i)Microsoft.CLR_v4\.0.[\\/]UsageLogs'

  - name: 'Python Standard Lib'
    target: 'ParentPath'
    condition: 'regex'
    pattern: '(?i)AppData.Local.Programs.Python.Python[0-9]+'

  - name: 'Windows Error Reporting'
    target: 'ParentPath'
    condition: 'regex'
    pattern: '(?i)Microsoft.Windows.WER.(ReportQueue|ReportArchive|ERC)'

  - name: 'Explorer Thumbs'
    target: 'FileName'
    condition: 'regex'
    pattern: '(?i)^thumbcache_.*\.db$'

  - name: "Windows User Folders"
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(My Music|My Pictures|My Videos|My Documents|Downloads|Desktop|Favorites|Links|Contacts|Searches)$"

  # --- [System Noise (Stronger)] ---
  - name: "Reliability Analysis Component (RAC)"
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)RACD"
    
  - name: "WMI & System Logs"
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)(WmiApRpl|wbem\\\\Performance)"
    
  - name: "Registry Backups (RegBack)"
    target: "ParentPath"
    condition: "contains"
    pattern: "config\\RegBack"

  - name: "System Debug & Temp Logs"
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(ChkAcc\\.bak|WRITABLE\\.TST|SCM\\.EVM.*|.*\\.OLD|.*\\.toc|.*\\.cmf|ResCache\\.dir|rc[0-9]+|ielock.*|HardAdmin.*)$"

  - name: "Browser Cache (General)"
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)[/\\\\](INetCache|History|Cookies|Recovery|Temporary Internet Files)[/\\\\]"

  - name: "Windows Installer & Updates"
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)\\\\(Windows\\\\(SoftwareDistribution|Installer|Servicing|WinSxS|assembly)|\\$Windows\\.~BT|System Volume Information)\\\\"

  - name: "Anti-Virus & System Logs"
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)\\\\(ProgramData\\\\(Microsoft\\\\Windows Defender|McAfee|Symantec)|Windows\\\\System32\\\\(Msdtc|wbem\\\\Performance|LogFiles)|Windows\\\\Debug)\\\\"

  - name: "XAMPP/Database Noise"
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)xampp[/\\\\]mysql[/\\\\]data"

  - name: "Forensic Tools"
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)[/\\\\](Tools|ghidra|sleuthkit|FTK Imager|exiftool|Autoruns|LogFileParser|YaraRules|Strings|Splunk)[/\\\\]"

  - name: "Trusted System Paths"
    category: "Registry"
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)^(?:[a-z]:)?\\\\(Windows\\\\System32|Program Files|Program Files \\(x86\\))"

  - name: "Windows Safe Paths"
    target: "Full_Path"
    condition: "regex"
    pattern: "(?i)\\\\(Windows\\\\(WinSxS|Servicing|SoftwareDistribution|CbsTemp|Assembly|Microsoft\\.NET\\\\Framework|System32\\\\DriverStore))"

  - name: "Known System DLLs"
    target: "Target_FileName"
    condition: "regex"
    pattern: "(?i)^(amd64_|x86_|wow64_|system\\.|microsoft\\.build).*"

  - name: "Safe Extensions"
    target: "Target_FileName"
    condition: "regex"
    pattern: "(?i)\\.(manifest|mum|cat)$"

  - name: "Garbage Extensions"
    target: "FileName"
    condition: "regex"
    pattern: "(?i)\\.(admx|adml|mum|cat|png|svg|js|json|xml|etl|evtx|log|tmp|db|dat|mui|inf|ico|css|html|htm|pf|ini|lnk|manifest|resx|nlp|pnf|cdf-ms|nls|tlb|xrm-ms|chk|trans-ms|blf|regtrans-ms|frm|ibd|opt|eot|txt)$"

  - name: "Standard Windows Processes"
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(svchost\\.exe|explorer\\.exe|searchui\\.exe|taskhostw\\.exe|sihost\\.exe|conhost\\.exe|dllhost\\.exe|lsass\\.exe|winlogon\\.exe|services\\.exe|spoolsv\\.exe)$"

  - name: "Browser Processes"
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(chrome\\.exe|msedge\\.exe|firefox\\.exe|iexplore\\.exe)$"


# ==========================================
# ü¶Å THREAT SIGNATURES (Alerts)
# ==========================================
threat_signatures:
  # --- [AION Specific Threats] ---
  - name: "Suspicious Script Persistence"
    tag: "SCRIPT_PERSISTENCE"
    score: 40
    target: "Target_FileName"
    condition: "regex"
    pattern: "(?i)\\.(bat|ps1|vbs|hta|js|wsf)$"

  - name: "Suspicious Command in Registry"
    tag: "SUSPICIOUS_CMD"
    score: 50
    target: "Full_Path"
    condition: "regex"
    pattern: "(?i)(powershell|cmd|wscript|cscript|mshta|rundll32|regsvr32|encodedcommand)"

  - name: "WebShell (Generic Names)"
    tag: "WEBSHELL"
    score: 100
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(c99|r57|b374k|wso|shell|cmd|uploader|minishell|phpspy|phpshell)[^\\.]*\\.(php|jsp|asp|aspx|cer|pl|cgi)$"

  - name: "WebShell (Broad Match)"
    tag: "WEBSHELL"
    score: 80
    target: "FileName"
    condition: "regex"
    pattern: "(?i)(c99|r57|wso|shell|cmd|uploader|phpshell|weevely|alfa)[^\\\\]*\\.(php|jsp|asp|aspx)"

  - name: "Rootkit (Hacker Defender)"
    tag: "ROOTKIT"
    score: 100
    target: "FileName"
    condition: "ends_with"
    pattern: ".bud"

  - name: "Suspicious Obfuscated Script"
    tag: "OBFUSCATION"
    score: 80
    target: "FileName"
    condition: "regex"
    pattern: "(?i)(tmpudvfh|tmpbrjvl|^[a-z]{8})\\.(php|aspx)$"

  # [NEW] Vulnerable Application Detection
  - name: "Known Vulnerable Application (DVWA)"
    tag: "VULN_APP_DETECTED"
    score: 100
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)(\\\\dvwa\\\\|/dvwa/|damn.*vulnerable)"

  - name: "Known Vulnerable Application (WebGoat/Mutillidae)"
    tag: "VULN_APP_DETECTED"
    score: 100
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)(webgoat|mutillidae|juiceshop|bwapp|hackazon)"

  # [NEW] PHP in Web Directory (Suspicious Upload)
  - name: "PHP Created in Web Directory"
    tag: "WEB_PHP_UPLOAD"
    score: 150
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)(htdocs|wwwroot|inetpub|public_html).*\\.php$"

  - name: "Suspicious IP Trace"
    tag: "IP_TRACE"
    score: 80
    target: "FileName"
    condition: "regex"
    pattern: "(?i)([0-9]{1,3}_[0-9]{1,3}_[0-9]{1,3}_[0-9]{1,3})"

  - name: "Script in Uploads/Temp"
    tag: "SUSPICIOUS_LOC"
    score: 80
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)\\\\(upload|temp|tmp|images|css|js)\\\\"

  - name: "Chronos High Value Targets"
    tag: "TARGET_INTEL"
    score: 100
    target: "FileName"
    condition: "regex"
    pattern: "(?i)(Secret_Project\\.pdf|Windows_Security_Audit|win_optimizer\\.lnk|SunShadow|Trigger|UpdateService\\.exe|Project_Chaos|Conf\\.7z)"

  - name: "Container Apps (LOLBINs)"
    tag: "CONTAINER"
    score: 50
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(cmd\\.exe|powershell\\.exe|pwsh\\.exe|wscript\\.exe|cscript\\.exe|mshta\\.exe|rundll32\\.exe|regsvr32\\.exe|bitsadmin\\.exe|certutil\\.exe|installutil\\.exe|psexec\\.exe|wmiprvse\\.exe|scrcons\\.exe|sh\\.exe|bash\\.exe)$"

  - name: "Suspicious Parent (Office)"
    tag: "SUSP_PARENT"
    score: 80
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(winword\\.exe|excel\\.exe|powerpnt\\.exe|outlook\\.exe)$"

  # [NEW] Case Specific Threat Signatures
  - name: "Masquerading LNK (Phishing)"
    tag: "CRITICAL_PHISHING"
    score: 300
    target: "FileName"
    condition: "regex"
    pattern: "(?i)(\\.(jpg|pdf|doc|docx|png|xlsx)\\.lnk|.*(adorable|cute|kitten|cats|invoice|payment|receipt).*\\.lnk)$"

  # [MODIFIED v6.0] Context-based CRX scoring
  - name: "CRX in Suspicious Path (Temp/Public/Downloads)"
    tag: "SUSPICIOUS_CRX_DROPPED"
    score: 150
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i)(\\\\Temp\\\\|\\\\Public\\\\|\\\\Downloads\\\\).*\\.crx$"

  - name: "CRX Adobe Masquerade"
    tag: "CRITICAL_MASQUERADE"
    score: 200
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)(Adobe|Acrobat|Program Files.*Adobe).*(extensions|plugins).*\\.crx$"

  - name: "Suspicious Notification Asset (Timestomp)"
    tag: "SUSP_TIMESTOMP_NOTIF"
    score: 200
    target: "ParentPath"
    condition: "regex"
    pattern: "(?i)AppData\\\\Local\\\\Microsoft\\\\Windows\\\\Notifications"

  # [NEW] Anti-Forensics & Evasion („Åì„Åì„Åå‰ªäÂõû„ÅÆËøΩÂä†ÂàÜ„Åß„ÅôÔºÅ)
  - name: "System Time Change (Timestomp)"
    tag: "CRITICAL_TIMESTOMP"
    score: 300
    target: "Action"
    condition: "regex"
    # Action„Ç´„É©„É†„Å´ "System time changed" „ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åü„ÇâÂç≥Ê§úÁü•
    pattern: "(?i)(system time changed|previous time|new time)"

  - name: "File Wiping Tool (Anti-Forensics)"
    tag: "CRITICAL_ANTIFORENSICS"
    score: 300
    target: "FileName"
    condition: "regex"
    pattern: "(?i)(bcwipe|sdelete|eraser|cipher\\.exe)"

  - name: "Evidence Cleaner (Anti-Forensics)"
    tag: "CRITICAL_ANTIFORENSICS"
    score: 300
    target: "FileName"
    condition: "regex"
    pattern: "(?i)(ccleaner|glary|bleachbit)"

    # --- [Exfiltration & Lateral Movement Rules] ---
  
  - name: "Potential Data Exfiltration (High Traffic)"
    tag: "CRITICAL_EXFILTRATION"
    score: 200
    target: "Action" # SRUM„ÅÆBytesSent„ÅåÂê´„Åæ„Çå„ÇãÂ†¥Âêà
    condition: "regex"
    # ‚ÄªSRUM„ÅÆ„Éë„Éº„ÇπÁµêÊûú„Å´‰æùÂ≠ò„Åó„Åæ„Åô„Åå„ÄÅ‰∏ÄËà¨ÁöÑ„Å™„Ç≠„Éº„ÉØ„Éº„Éâ„Å®„Åó„Å¶
    pattern: "(?i)(bytes sent.*[0-9]{7,})" # 10MB‰ª•‰∏äÁõÆÂÆâ

  - name: "Network Share Access (Lateral Movement)"
    tag: "CRITICAL_LATERAL"
    score: 150
    target: "Target_Path" # ShellBags„ÅÆ„Éë„Çπ
    condition: "regex"
    pattern: "^\\\\[a-zA-Z0-9]" # UNC„Éë„Çπ (\\Server...)

  - name: "Suspicious USB Connection"
    tag: "DEVICE_INSERTION"
    score: 100
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i)usbstor"

  - name: "ShimCache Execution Trace"
    tag: "EXECUTION_TRACE"
    score: 80
    target: "Artifact_Type"
    condition: "contains"
    pattern: "AppCompatCache"

  # ==========================================
  # üîß SysInternals Tool Detection (Challenge #7)
  # ==========================================
  # --- Remote Execution (Critical) ---
  - name: "SysInternals PsExec Execution"
    tag: "CRITICAL_LATERAL_PSEXEC"
    score: 200
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(psexec|psexec64|paexec)\\.exe$"

  - name: "PsExec Service Created"
    tag: "CRITICAL_LATERAL_PSEXEC"
    score: 250
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(psexesvc|remcomsvc)\\.exe$"

  # --- Credential/Memory Dump (Critical) ---
  - name: "SysInternals Procdump Execution"
    tag: "CRITICAL_CREDENTIAL_DUMP"
    score: 250
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(procdump|procdump64)\\.exe$"

  # --- Reconnaissance Tools (Medium-High) ---
  - name: "SysInternals Process Monitor"
    tag: "RECON_SYSINTERNALS"
    score: 100
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(procmon|procmon64)\\.exe$"

  - name: "SysInternals Process Explorer"
    tag: "RECON_SYSINTERNALS"
    score: 80
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(procexp|procexp64)\\.exe$"

  - name: "SysInternals Autoruns"
    tag: "RECON_PERSISTENCE"
    score: 100
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(autoruns|autorunsc|autoruns64)\\.exe$"

  - name: "SysInternals AccessChk"
    tag: "RECON_PRIVESC"
    score: 120
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(accesschk|accesschk64)\\.exe$"

  # --- Process Manipulation ---
  - name: "SysInternals PsKill"
    tag: "DEFENSE_EVASION"
    score: 150
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(pskill|pskill64)\\.exe$"

  - name: "SysInternals PsSuspend"
    tag: "DEFENSE_EVASION"
    score: 100
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^(pssuspend|pssuspend64)\\.exe$"

  # ==========================================
  # üîî Service Creation Detection (Event ID 7045/4697)
  # ==========================================
  - name: "Service Installation Detected (Event 7045)"
    tag: "PERSISTENCE_SERVICE"
    score: 150
    target: "Action"
    condition: "regex"
    pattern: "(?i)(service.*install|7045|a new service was installed)"

  - name: "Service Installation via Security Log (Event 4697)"
    tag: "PERSISTENCE_SERVICE"
    score: 150
    target: "Action"
    condition: "regex"
    pattern: "(?i)(4697|service was installed)"

  - name: "Suspicious Service Name Pattern"
    tag: "CRITICAL_PERSISTENCE"
    score: 200
    target: "Message"
    condition: "regex"
    pattern: "(?i)(PSEXESVC|RemComSvc|BTOBTO|metsvc|persistence)"

  # ==========================================
  # üåê SysInternals Download Source Detection
  # ==========================================
  - name: "SysInternals Download Detected"
    tag: "TOOLING_DOWNLOAD"
    score: 120
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i)(live\\.sysinternals\\.com|download\\.sysinternals\\.com)"

  # ==========================================
  # üé≠ Case 7: Masquerade Detection
  # ==========================================
  - name: "SysInternals.exe Masquerade (Exact)"
    tag: "CRITICAL_MASQUERADE"
    score: 300
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^sysinternals\\.exe$"

  - name: "VMToolsIO.exe Masquerade"
    tag: "CRITICAL_MASQUERADE"
    score: 300
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^vmtoolsio\\.exe$"

  # ==========================================
  # üìÅ Suspicious Path Execution
  # ==========================================
  - name: "Execution from Public Downloads"
    tag: "SUSPICIOUS_PATH_EXEC"
    score: 200
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i)\\\\Users\\\\Public\\\\(Downloads|Documents)?\\\\.*\\.exe$"

  - name: "Execution from User Downloads"
    tag: "SUSPICIOUS_PATH_EXEC"
    score: 150
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i)\\\\Users\\\\[^\\\\]+\\\\Downloads\\\\.*\\.exe$"

  # üöÄ [NEW] UNC Path Execution (High Risk)
  - name: "Tool Execution from UNC Share"
    tag: "CRITICAL_LATERAL_EXECUTION"
    score: 400
    target: "Target_Path" # „Åæ„Åü„ÅØ Full_Path, Command_Line
    condition: "regex"
    pattern: "(?i)^\\\\\\\\[a-z0-9-._]+\\\\[a-z0-9-._$]+\\\\.*\\.(exe|bat|ps1|cmd)$"

  # [NEW] DCode Specific Alert (Critical Anti-Forensics)
  - name: "DCode Timestamp Identifier Detected"
    tag: "CRITICAL_ANTIFORENSICS_TOOL"
    score: 500
    target: "FileName"
    condition: "regex"
    pattern: "(?i)dcode.*\\.exe"

  - name: "Execution from Temp Folder"
    tag: "SUSPICIOUS_PATH_EXEC"
    score: 180
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i)\\\\(Temp|Tmp)\\\\.*\\.exe$"

  # ==========================================
  # üîç Recon Indicators (Case 7 Specific)
  # ==========================================
  - name: "Task Manager Execution"
    tag: "RECON_INDICATOR"
    score: 30
    target: "FileName"
    condition: "regex"
    pattern: "(?i)^taskmgr\\.exe$"

    tag: "RECON_INDICATOR"
    score: 40
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i)Microsoft\\.Windows\\.Shell\\.RunDialog"

# ==========================================
# üöÄ Universal Threat Signatures (BaseDetector)
# ==========================================
threat_signatures:
  # [1] Reconnaissance Inference (Web History & Cache)
  - name: "Web Recon: XAMPP Dashboard"
    tag: "INTERNAL_RECON_WEB"
    score: 350
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i)(xampp-logo|bitnami-xampp)"

  - name: "Web Recon: phpMyAdmin"
    tag: "CRITICAL_DB_ACCESS"
    score: 350
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i)(pma_logo|logo_left|phpmyadmin)"

  # [2] Sensitive Data Access (Exfiltration)
  - name: "Sensitive File Access (Confidential)"
    tag: "SENSITIVE_DATA_ACCESS"
    score: 800
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i).*(confidential|secret|password|Ê©üÂØÜ|Á§æÂ§ñÁßò).*\\.(rtf|docx?|xlsx?|pdf|txt)$"

  - name: "Sensitive File Access (General)"
    tag: "SENSITIVE_DATA_ACCESS"
    score: 500
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i)(passwords?|accounts?|credentials?)\\.(txt|xlsx?|docx?)$"

  # [3] UNC Execution & Tools
  - name: "UNC Path Execution Enforcement"
    tag: "UNC_EXECUTION"
    score: 200
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i)^\\\\\\\\[a-z0-9-._]+\\\\[a-z0-9-._$]+\\\\.*\\.(exe|bat|ps1|cmd)$"

  - name: "DCode Timestamp Identifier"
    tag: "CRITICAL_ANTIFORENSICS_TOOL"
    score: 500
    target: "Target_Path"
    condition: "regex"
    pattern: "(?i)dcode.*\\.exe"