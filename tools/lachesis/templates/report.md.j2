# {{ txt.title }} - {{ hostname }}

### ğŸ›¡ï¸ {{ txt.coc_header }}
| Item | Details |
|---|---|
| **Target Host** | **{{ hostname }}** |
| **OS Info** | {{ metadata.os_info }} |
| **Primary User** | {{ metadata.primary_user }} |
| **Incident Scope** | **{{ analysis_data.time_range }}** |
| **Report Date** | {{ now }} |

---

## ğŸ“š Table of Contents
- [{{ txt.h1_exec }}](#{{ txt.h1_exec | lower | replace(' ', '-') | replace('.', '') | replace('&', '') | replace('(', '') | replace(')', '') | replace('/', '') }})
- [{{ txt.h1_origin }}](#{{ txt.h1_origin | lower | replace(' ', '-') | replace('.', '') | replace('&', '') | replace('(', '') | replace(')', '') | replace('/', '') }})
- [{{ txt.h1_time }}](#{{ txt.h1_time | lower | replace(' ', '-') | replace('.', '') | replace('&', '') | replace('(', '') | replace(')', '') | replace('/', '') }})
- [{{ txt.h1_tech }}](#{{ txt.h1_tech | lower | replace(' ', '-') | replace('.', '') | replace('&', '') | replace('(', '') | replace(')', '') | replace('/', '') }})
- [{{ txt.h1_stats }}](#{{ txt.h1_stats | lower | replace(' ', '-') | replace('.', '') | replace('&', '') | replace('(', '') | replace(')', '') | replace('/', '') }})
- [{{ txt.h1_rec }}](#{{ txt.h1_rec | lower | replace(' ', '-') | replace('.', '') | replace('&', '') | replace('(', '') | replace(')', '') | replace('/', '') }})
- [{{ txt.h1_app }}](#{{ txt.h1_app | lower | replace(' ', '-') | replace('.', '') | replace('&', '') | replace('(', '') | replace(')', '') | replace('/', '') }})
- [Pivot Config (Deep Dive Targets)](#deep-dive-recommendation)

---

## {{ txt.h1_exec }}
{{ dynamic_verdict.title }}
{{ dynamic_verdict.description }}

{{ txt.attack_methods_label }} {{ attack_methods | join(', ') }}.

{{ txt.deep_dive_note }}

{{ mermaid_timeline }}

### ğŸ’ Key Indicators (Critical Only)
{% for cat, items in key_indicators.items() %}
#### {{ cat }}
| Time (UTC) | Value / Artifact | Impact/Target | Score |
|---|---|---|---|
{% for ioc in items -%}
| {{ ioc.Time | replace('T', ' ') | truncate(19, True, '') }} | `{{ ioc.Value }}` | {{ ioc.Impact }} | {{ ioc.Score }} |
{% endfor %}
{% endfor %}

<details>
<summary>ğŸ“Š ã‚¹ã‚³ã‚¢åŸºæº– (Score Legend)</summary>

| Score | æ„å‘³ | ä¾‹ |
|-------|------|-----|
| 800+ | ğŸ”´ Critical | WebShell, èªè¨¼æƒ…å ±ã‚¢ã‚¯ã‚»ã‚¹, Anti-Forensics |
| 500-799 | ğŸŸ  High | ä¸å¯©ãªãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ, Lateral Movement |
| 300-499 | ğŸŸ¡ Medium | åµå¯Ÿæ´»å‹•, è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ |
| <300 | âšª Low | ãƒã‚¤ã‚ºå€™è£œ (è‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿å¯¾è±¡) |

</details>

---

## {{ txt.h1_origin }}
{% if phishing_lnks %}
{{ txt.phishing_confirmed }}
{{ txt.phishing_lnk_detected.format(count=phishing_lnks|length) }}
{{ txt.phishing_table_header }}
{% for seed in phishing_lnks[:10] %}
| `{{ seed.Target_File }}` | {{ seed.Timestamp_Hint | replace('T', ' ') | truncate(19, True, '') }} | {{ seed.Origin_Desc }} |
{% endfor %}
{% endif %}

{% if drop_items %}
{{ txt.dropped_artifacts_header }}
{{ txt.dropped_table_header }}
{% for seed in drop_items[:10] %}
| `{{ seed.Target_File }}` | {{ seed.Timestamp_Hint | replace('T', ' ') | truncate(19, True, '') }} | {{ seed.Origin_Desc }} |
{% endfor %}
{% endif %}

{% if not phishing_lnks and not drop_items %}
{{ txt.no_vector_found }}
{% endif %}

{# [P3'] Hypothesis Injection for CTF/Missing Trace #}
{% if drop_items and not phishing_lnks %}
### ğŸ•µï¸â€â™‚ï¸ Initial Access Hypothesis (No Direct Trace Found)
æ˜ç¢ºãªæµå…¥çµŒè·¯ï¼ˆLNK/Zone.Identifierï¼‰ãŒç¢ºèªã§ãã¾ã›ã‚“ã§ã—ãŸãŒã€æ¤œå‡ºã•ã‚ŒãŸã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‹ã‚‰ä»¥ä¸‹ã®å¯èƒ½æ€§ãŒå¼·ãæ¨æ¸¬ã•ã‚Œã¾ã™ï¼š

1.  **Public Exploit (XAMPP/DVWA)**: 
    - æ¤œå‡ºã•ã‚ŒãŸ `dvwa`, `xampp`, `webshell.php` ã®å­˜åœ¨ã‹ã‚‰ã€å…¬é–‹ã•ã‚Œã¦ã„ã‚‹è„†å¼±æ€§ï¼ˆSQLi, File Uploadï¼‰ã‚’æ‚ªç”¨ã—ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
2.  **RDP Brute Force**: 
    - `Event ID 4625 (Logon Failure)` ã‚„ `Change Password` ã®ç—•è·¡ãŒç¢ºèªã•ã‚Œã¦ã„ã‚‹å ´åˆã€ç·å½“ãŸã‚Šæ”»æ’ƒã«ã‚ˆã‚‹ç®¡ç†è€…æ¨©é™å¥ªå–ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
3.  **Lateral Movement (SMB/Admin Share)**:
    - `dsadd.exe` ã‚„ `ftk imager.exe` ã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ãŒç¢ºèªã•ã‚Œã¦ã„ã‚‹å ´åˆã€æ—¢ã«ä¾µå®³ã•ã‚ŒãŸä»–ç«¯æœ«ã‹ã‚‰ã®æ¨ªå±•é–‹ã‚‚ç–‘ã‚ã‚Œã¾ã™ã€‚

> **Recommendation:** `Event ID 4688` (Process Creation) ã®æ¬ æã‚’ç¢ºèªã—ã€Webã‚µãƒ¼ãƒãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ï¼ˆApache access.logï¼‰ã‚’é‡ç‚¹çš„ã«èª¿æŸ»ã—ã¦ãã ã•ã„ã€‚
{% endif %}

---

## {{ txt.h1_time }}
(Detailed Timeline - High-priority events only. Score < 400 are aggregated.)

{% set sorted_iocs = all_iocs | sort(attribute='Time') %}
{% set current_date = namespace(val='') %}
{% set current_minute = namespace(val='') %}
{% set minute_buffer = namespace(count=0, first_val='') %}
{% for ev in sorted_iocs if ev.Score|int >= 400 %}
{% set ev_date = ev.Time.split('T')[0] if ev.Time else 'Unknown' %}
{% set ev_minute = ev.Time[:16] if ev.Time else 'Unknown' %}
{% if ev_date != current_date.val %}
{% set current_date.val = ev_date %}

### ğŸ“… {{ ev_date }}
| Time (UTC) | Category | Event Summary | Path | Score |
|---|---|---|---|---|
{% endif %}
{# P2: Show primary tag only (first tag before comma) #}
{% set primary_tag = ev.Tag.split(',')[0] if ev.Tag else ev.Type %}
| {{ ev.Time.replace('T', ' ')[:16] if ev.Time else '-' }} | {{ primary_tag[:20] }} | **{{ ev.Value }}** | `{{ ev.Path[-35:] if ev.Path else '-' }}` | {{ ev.Score }} |
{% endfor %}

> ğŸ“¦ **ä½ã‚¹ã‚³ã‚¢ã‚¤ãƒ™ãƒ³ãƒˆ (Score < 400)** ã¯å¯èª­æ€§ã®ãŸã‚çœç•¥ã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯ `Timeline_Full.csv` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


---

## {{ txt.h1_tech }}
{% if anti_forensics_tools %}
{{ txt.anti_forensics_header }}
{% for tool in anti_forensics_tools %}
#### {{ tool.Name }}
- ğŸ“Š **Run Count**: **{{ tool.RunCount }}**
- ğŸ• **Last Execution**: {{ tool.LastRun }} (UTC)
- âš ï¸ **Severity**: CRITICAL
- ğŸ” **Description**: {{ tool.Desc }}

ğŸ•µï¸ **Analyst Note**:
{{ tool.AnalystNote }}

{% endfor %}
{{ txt.missing_evidence_header }}
{{ txt.missing_evidence_table }}
{{ txt.missing_evidence_note }}
---
{% endif %}

### ğŸ” Detailed Findings by Category

{% for cat, items in technical_findings.items() %}
#### {{ cat }}
{% if "INITIAL ACCESS" in cat %}
{% if high_interest_lnks %}
{{ txt.high_interest_artifacts }}
{% for ioc in high_interest_lnks %}
- **{{ ioc.Time | replace('T', ' ') | truncate(19, True, '') }}** | `{{ ioc.Value }}`
{% if ioc.Insight %}  - ğŸ•µï¸ **Analyst Note:** {{ ioc.Insight }}{% endif %}
{% endfor %}
{% endif %}
{% if generic_lnks %}
{{ txt.other_lnks_header.format(count=generic_lnks|length) }}
{{ txt.other_lnks_desc }}
{% for ioc in generic_lnks %}
- {{ ioc.Time | replace('T', ' ') | truncate(19, True, '') }} | `{{ ioc.Value }}`
{% endfor %}
{% endif %}
{% else %}
{# v9.2: Show Insight ONLY for the first item; list others as filenames only #}
{% set first_insight_shown = namespace(val=false) %}
{% for ioc in items %}
{% if ioc.Insight and not first_insight_shown.val %}
ğŸ•µï¸ **Analyst Note:** {{ ioc.Insight }}
{% set first_insight_shown.val = true %}

**Affected Artifacts ({{ items|length }} files):**
{% endif %}
- {{ ioc.Time | replace('T', ' ') | truncate(19, True, '') }} | `{{ ioc.Value }}`
{% endfor %}
{% endif %}

{% endfor %}

{{ attack_chain_mermaid }}

---

{{ plutos_section }}

---

## {{ txt.h1_stats }}
{{ txt.stats_header }}
| Category | Count | Note |
|---|---|---|
| **Total Events Analyzed** | **{{ stats.total_processed }}** | After filtering |
| Critical Detections | {{ stats.crit_count }} | {{ "%.2f"|format(stats.crit_ratio) }}% of analyzed |
| Filtered Out (Noise) | {{ stats.noise_removed }} | Removed before analysis |

{{ txt.stats_critical_breakdown }}
| Type | Count | Max Score | Impact |
|---|---|---|---|
{% for row in stats.critical_breakdown %}
| **{{ row.Type }}** | **{{ row.Count }}** | {{ row.MaxScore }} | {{ row.Impact }} |
{% endfor %}

{% if stats.medium_events %}
{{ txt.stats_medium_events.format(count=stats.medium_count) }}
{% for k, v in stats.medium_breakdown.items() %}
- {{ k }}: {{ v }}
{% endfor %}
{% endif %}

{% if stats.noise_stats %}
{{ txt.stats_noise_header }}
| Filter Reason | Count |
|---|---|
{% for k, v in stats.noise_stats.items() %}
| {{ k }} | {{ v }} |
{% endfor %}
{% endif %}

---

## {{ txt.h1_rec }}
{{ txt.rec_header }}
{{ txt.rec_table_header }}
{% if recommendations.p0_evtlog %}{{ txt.rec_p0_evtlog }}{% endif %}
{% if recommendations.p0_crx %}{{ txt.rec_p0_crx }}{% endif %}
{{ txt.rec_p0_network }}
{{ txt.rec_p1_lateral }}
{{ txt.rec_p1_creds }}

---

## {{ txt.h1_app }}
{{ txt.ioc_header }}

### 7.1 ğŸ”¥ High-Confidence IOCs (Score â‰¥ 500 - Critical Threats) (Top 15)
| Type | Artifact | Score | Tags |
|---|---|---|---|
{% for ioc in iocs_section_7_1 %}
| {{ ioc.Type }} | `{{ ioc.Value }}` | {{ ioc.Score }} | {{ ioc.Tag }} |
{% endfor %}

### 7.2 ğŸ“‹ Contextual Artifacts (Top 50 Relevant)
| Type | Artifact | Score | Tags |
|---|---|---|---|
{% for ioc in iocs_section_7_2 %}
| {{ ioc.Type }} | `{{ ioc.Value }}` | {{ ioc.Score }} | {{ ioc.Tag }} |
{% endfor %}


---
*Report woven by SkiaHelios (Grimoire Engine v6.5)* ğŸ¦ğŸ›¡ï¸
